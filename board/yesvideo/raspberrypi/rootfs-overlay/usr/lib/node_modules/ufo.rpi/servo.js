var gpio = require('rpi-gpio');
var piblaster = require('pi-blaster.js');
var pins = require('./pins');

function reset() {
    gpio.setup(pins.servo, gpio.DIR_OUT, null, function() {
        set(0);
    });
}

var servoWatchdog = null;

function set(deg, cb) {
    var max = 0.24;
    var min = 0.054;
    deg = Math.min(180, Math.max(0, deg));

    piblaster.setPwm(pins.servoBcm, (deg / 180.0) * (max - min) + min, cb);

    clearTimeout(servoWatchdog);
    servoWatchdog = setTimeout(function() {piblaster.setPwm(pins.servoBcm, 0)}, 1000);
}

module.exports = {
    reset: reset,
    set: set
}