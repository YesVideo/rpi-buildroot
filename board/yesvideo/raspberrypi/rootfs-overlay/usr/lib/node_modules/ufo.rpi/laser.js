var gpio = require('rpi-gpio');
var pins = require('./pins');

var LASER_AUTO_OFF_MS = 30 * 1000;
var laserAutoOffWatchdog;

function reset() {
    gpio.setup(pins.laser, gpio.DIR_OUT, null, function() {
        off();
    });
}

function set(onOff, cb) {
    if (laserAutoOffWatchdog != null) {
        clearTimeout(laserAutoOffWatchdog);
        laserAutoOffWatchdog = null;
    }

    gpio.write(pins.laser, onOff, cb);

    if (onOff) {
        laserAutoOffWatchdog = setTimeout(off, LASER_AUTO_OFF_MS);
    }
};

function on(cb) {
    set(true, cb);
}

function off(cb) {
    set(false, cb);
}

module.exports = {
  reset: reset,
  set: set,
  on: on,
  off: off  
};